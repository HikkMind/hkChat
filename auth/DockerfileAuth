FROM golang:alpine AS builder

WORKDIR /app

COPY ./go.mod ./go.sum ./
COPY ./auth ./auth
COPY ./.dbenv ./auth
COPY ./tables ./tables
RUN go mod download

WORKDIR /app/auth

RUN go build -o auth

FROM alpine:3
COPY --from=builder /app/auth/auth /bin/auth
COPY --from=builder /app/auth/.dbenv /bin/.dbenv
EXPOSE 8081

WORKDIR /bin

ENTRYPOINT ["./auth"]
